# 
# Set the path for auto-generated "acpl.h" file and fill in the defs
# 

set(ACPL_AUTOGEN_HEADER "${CMAKE_CURRENT_BINARY_DIR}/acpl.h")
file(WRITE "${ACPL_AUTOGEN_HEADER}" "/* This file was auto-generated by cmake */

#ifndef ACPL_ACPL_H
#define ACPL_ACPL_H

#define ${ACPL_DEF_BUILTAS}

#endif // ACPL_ACPL_H
")


# 
# Sources
# 

set(LIBRARY_SOURCE_FILES "")
macro(add_source_file SOURCE_FILE)
	set(LIBRARY_SOURCE_FILES ${LIBRARY_SOURCE_FILES} "${SOURCE_FILE}")
endmacro(add_source_file)

# Root directory source files
add_source_file("Bits.cpp")
add_source_file("Charsets.cpp")
add_source_file("Devel.cpp")
add_source_file("Endian.cpp")
add_source_file("Io.cpp")
add_source_file("Memory.cpp")
add_source_file("String.cpp")
add_source_file("Thread.cpp")
add_source_file("Time.cpp")
add_source_file("Uri.cpp")

# FS source files
add_source_file("fs/Dir.cpp")
add_source_file("fs/File.cpp")
add_source_file("fs/Path.cpp")

# Net source files
add_source_file("net/Address.cpp")
add_source_file("net/Header.cpp")
add_source_file("net/Poll.cpp")
add_source_file("net/Socket.cpp")


# 
# Building
# NOTE:
#   Whether the library will be STATIC or SHARED is dependent on the
#   BUILD_SHARED_LIBS variable. If present and set to TRUE, the output library
#   will be SHARED, otherwise it will be STATIC.
# 

add_library(acpl ${LIBRARY_SOURCE_FILES})
if (BUILD_SHARED_LIBS)
	target_link_libraries(acpl ${ACPL_DEPLIBRARIES})
endif (BUILD_SHARED_LIBS)


# 
# Installing
# 

# Library installation
install(TARGETS acpl DESTINATION "lib")

# Qt support
install(FILES
		acpl.pri
	DESTINATION share)

# Root directory header files installation
install(FILES
		"${ACPL_AUTOGEN_HEADER}" # auto-generated "acpl.h" file
		Array.h
		Bits.h
		Charsets.h
		Defines.h
		Devel.h
		Endian.h
		Io.h
		Macros.h
		Memory.h
		Raii.h
 		String.h
		Thread.h
		Time.h
		Types.h
		Uri.h
	DESTINATION include/acpl)

# IO header files installation
install(FILES
		fs/Dir.h
		fs/File.h
		fs/Path.h
	DESTINATION include/acpl/fs)

# Net header files installation
install(FILES
		net/Address.h
		net/Header.h
		net/Poll.h
		net/Socket.h
	DESTINATION include/acpl/net)
